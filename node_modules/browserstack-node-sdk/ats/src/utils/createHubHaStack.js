const a28_0x220cfa=a28_0x4ac2;function a28_0x10b7(){const _0x3f954b=['load','utf-8','252383CCAPSH','stackCreateComplete','split','KMOEr','join','CloudFormation','Properties','./AWSUtils','cbMnk','createHubHaStack','apiVersion','545736xjypqG','VpcId','TemplateBody','OnFailure','Wdgoq','stringify','RbHDn','CAPABILITY_NAMED_IAM','createStack','promise','readFileAsync','YEmqK','21fxdsXt','150488jUjXcJ','Waiting\x20for\x20CloudFormation\x20stack\x20to\x20complete','35496IPUUwA','StackName','25335yCcUSk','1661094blLPtE','js-yaml-cloudformation-schema','Parameters','awsObj','schema','../config/constants','DujHi','path','42BuWJdl','CzpXx','StackId','Capabilities','../config/logger','DELETE','toString','-cf','537705ZBRKfX','80hjlOhi','BHXYv','RhTgH','valueOf','BaseResourceName','ClusterOIDCURL','browserstack:creationDate','push','Resources','Tags','WujDC','js-yaml'];a28_0x10b7=function(){return _0x3f954b;};return a28_0x10b7();}(function(_0x4f4daa,_0x38fce6){const _0x9d9f7c=a28_0x4ac2,_0x6898f=_0x4f4daa();while(!![]){try{const _0x1a366b=parseInt(_0x9d9f7c(0x17d))/0x1+parseInt(_0x9d9f7c(0x188))/0x2+-parseInt(_0x9d9f7c(0x1a2))/0x3*(parseInt(_0x9d9f7c(0x197))/0x4)+parseInt(_0x9d9f7c(0x199))/0x5+parseInt(_0x9d9f7c(0x19a))/0x6+-parseInt(_0x9d9f7c(0x194))/0x7*(parseInt(_0x9d9f7c(0x195))/0x8)+parseInt(_0x9d9f7c(0x1aa))/0x9*(-parseInt(_0x9d9f7c(0x1ab))/0xa);if(_0x1a366b===_0x38fce6)break;else _0x6898f['push'](_0x6898f['shift']());}catch(_0x3b65af){_0x6898f['push'](_0x6898f['shift']());}}}(a28_0x10b7,0x2443a));function a28_0x4ac2(_0x4d7e6d,_0x44b702){const _0x10b77c=a28_0x10b7();return a28_0x4ac2=function(_0x4ac29c,_0x37a59e){_0x4ac29c=_0x4ac29c-0x178;let _0x3efc60=_0x10b77c[_0x4ac29c];return _0x3efc60;},a28_0x4ac2(_0x4d7e6d,_0x44b702);}const fs=require('fs'),path=require(a28_0x220cfa(0x1a1)),Promise=require('bluebird'),yaml=require(a28_0x220cfa(0x17a)),{CLOUDFORMATION_SCHEMA}=require(a28_0x220cfa(0x19b)),AWS=require(a28_0x220cfa(0x184))[a28_0x220cfa(0x19d)],AWSUtils=require('./AWSUtils'),{CLUSTER_HUB_HA_STACK_NAME,COMMON_HST_TAGS}=require(a28_0x220cfa(0x19f)),{logger}=require(a28_0x220cfa(0x1a6));Promise['promisifyAll'](fs);const addTags=async(_0x26cd20,_0x1238a7)=>{const _0xa673e4=a28_0x220cfa;for(const _0x478fd3 in _0x26cd20[_0xa673e4(0x1b3)]){_0x26cd20['Resources'][_0x478fd3][_0xa673e4(0x183)]&&_0x26cd20[_0xa673e4(0x1b3)][_0x478fd3][_0xa673e4(0x183)][_0xa673e4(0x178)]&&_0x26cd20[_0xa673e4(0x1b3)][_0x478fd3][_0xa673e4(0x183)]['Tags'][_0xa673e4(0x1b2)](..._0x1238a7);}};exports[a28_0x220cfa(0x186)]=async(_0x5dcbde,_0x3a7c8c=null)=>{const _0x3b4d62=a28_0x220cfa,_0x1aae17={'RhTgH':'browserstack:cluster','RbHDn':_0x3b4d62(0x1b1),'KMOEr':'2010-05-15','CzpXx':'CFTemplates','cbMnk':'hub-ha.yaml','Wdgoq':_0x3b4d62(0x17c),'KNGmD':function(_0x2bf889,_0x44531b,_0x2c3f82){return _0x2bf889(_0x44531b,_0x2c3f82);},'YEmqK':'://','DujHi':_0x3b4d62(0x1a7),'BHXYv':_0x3b4d62(0x189),'WujDC':_0x3b4d62(0x1af),'mCBAI':_0x3b4d62(0x1b0),'pHAqS':_0x3b4d62(0x18f),'DiUbl':_0x3b4d62(0x196),'VEzWw':_0x3b4d62(0x17e)},_0x48c154=COMMON_HST_TAGS,_0x497879={};_0x497879['Key']=_0x1aae17[_0x3b4d62(0x1ad)],_0x497879['Value']=_0x5dcbde,_0x48c154[_0x3b4d62(0x1b2)](_0x497879),_0x48c154[_0x3b4d62(0x1b2)]({'Key':_0x1aae17[_0x3b4d62(0x18e)],'Value':new Date()[_0x3b4d62(0x1ae)]()[_0x3b4d62(0x1a8)]()});const _0x4408e2={};_0x4408e2[_0x3b4d62(0x187)]=_0x1aae17[_0x3b4d62(0x180)];const _0x3241b7=new AWS[(_0x3b4d62(0x182))](_0x4408e2),_0x50cb05=await fs[_0x3b4d62(0x192)](path[_0x3b4d62(0x181)](__dirname,'..',_0x1aae17[_0x3b4d62(0x1a3)],_0x1aae17[_0x3b4d62(0x185)]),_0x1aae17[_0x3b4d62(0x18c)]),_0x4f1ef9={};_0x4f1ef9[_0x3b4d62(0x19e)]=CLOUDFORMATION_SCHEMA;const _0x3e519d=yaml[_0x3b4d62(0x17b)](_0x50cb05,_0x4f1ef9);await _0x1aae17['KNGmD'](addTags,_0x3e519d,_0x48c154);const _0x559c41=JSON[_0x3b4d62(0x18d)](_0x3e519d);let _0x47498e=await AWSUtils['getOidcUrl'](_0x5dcbde);_0x47498e=_0x47498e[_0x3b4d62(0x17f)](_0x1aae17[_0x3b4d62(0x193)])[0x1];const _0x4e5689={};_0x4e5689[_0x3b4d62(0x198)]=CLUSTER_HUB_HA_STACK_NAME+'-'+_0x5dcbde+_0x3b4d62(0x1a9),_0x4e5689[_0x3b4d62(0x18b)]=_0x1aae17[_0x3b4d62(0x1a0)],_0x4e5689[_0x3b4d62(0x18a)]=_0x559c41,_0x4e5689[_0x3b4d62(0x19c)]=[{'ParameterKey':_0x1aae17[_0x3b4d62(0x1ac)],'ParameterValue':_0x3a7c8c},{'ParameterKey':_0x1aae17[_0x3b4d62(0x179)],'ParameterValue':CLUSTER_HUB_HA_STACK_NAME+'-'+_0x5dcbde},{'ParameterKey':_0x1aae17['mCBAI'],'ParameterValue':_0x47498e}],_0x4e5689[_0x3b4d62(0x1a5)]=[_0x1aae17['pHAqS']],_0x4e5689['Tags']=_0x48c154;const _0x191740=_0x4e5689,_0x30a6fa=await _0x3241b7[_0x3b4d62(0x190)](_0x191740)['promise']();logger['info'](_0x1aae17['DiUbl']);const _0x3a9e29={};return _0x3a9e29[_0x3b4d62(0x198)]=_0x30a6fa[_0x3b4d62(0x1a4)],_0x3241b7['waitFor'](_0x1aae17['VEzWw'],_0x3a9e29)[_0x3b4d62(0x191)]();};