const a104_0x519981=a104_0xb9c3;(function(_0x24f813,_0x4994d2){const _0x4fb8ad=a104_0xb9c3,_0x969c17=_0x24f813();while(!![]){try{const _0x5137b6=-parseInt(_0x4fb8ad(0x176))/0x1*(parseInt(_0x4fb8ad(0x16a))/0x2)+parseInt(_0x4fb8ad(0x153))/0x3*(-parseInt(_0x4fb8ad(0x171))/0x4)+parseInt(_0x4fb8ad(0x166))/0x5*(parseInt(_0x4fb8ad(0x188))/0x6)+-parseInt(_0x4fb8ad(0x18a))/0x7*(parseInt(_0x4fb8ad(0x161))/0x8)+-parseInt(_0x4fb8ad(0x159))/0x9*(parseInt(_0x4fb8ad(0x14b))/0xa)+-parseInt(_0x4fb8ad(0x17a))/0xb*(parseInt(_0x4fb8ad(0x157))/0xc)+parseInt(_0x4fb8ad(0x147))/0xd;if(_0x5137b6===_0x4994d2)break;else _0x969c17['push'](_0x969c17['shift']());}catch(_0x32242b){_0x969c17['push'](_0x969c17['shift']());}}}(a104_0x10ea,0x5851c));const fs=require('fs'),path=require(a104_0x519981(0x189)),os=require('os'),{spawn}=require('child_process'),helper=require(a104_0x519981(0x18f)),logger=require('../logger')[a104_0x519981(0x156)],{getLogDir}=require(a104_0x519981(0x15f)),testHubConstants=require(a104_0x519981(0x177)),PerformanceTester=require(a104_0x519981(0x14c)),{PERCY_EVENTS:PerformanceEvents}=require(a104_0x519981(0x160)),PercyBinary=require('./PercyBinary');function a104_0xb9c3(_0x3a14a2,_0x94275e){const _0x10ea7d=a104_0x10ea();return a104_0xb9c3=function(_0xb9c3e4,_0x218cb7){_0xb9c3e4=_0xb9c3e4-0x13b;let _0x5d2b5a=_0x10ea7d[_0xb9c3e4];return _0x5d2b5a;},a104_0xb9c3(_0x3a14a2,_0x94275e);}class Percy{#logfile=path[a104_0x519981(0x18e)](getLogDir(),a104_0x519981(0x165));#address=process[a104_0x519981(0x15a)][a104_0x519981(0x16b)]||'http://localhost:5338';#binaryPath=null;#config=null;#proc=null;#isApp=![];[a104_0x519981(0x17e)]=![];constructor(_0x1d1625){const _0x5aafb7=a104_0x519981;this.#config=_0x1d1625,!!_0x1d1625[_0x5aafb7(0x163)]&&(this.#isApp=!![]);}async #getBinaryPath(){const _0x1be4af=a104_0x519981;if(!this.#binaryPath){const _0x360c03=new PercyBinary();PerformanceTester[_0x1be4af(0x18b)](PerformanceEvents[_0x1be4af(0x158)]),this.#binaryPath=await _0x360c03['getBinaryPath'](this.#config),PerformanceTester[_0x1be4af(0x167)](PerformanceEvents['DOWNLOAD']);}return this.#binaryPath;}async #sleep(_0x6498ad){return new Promise(_0x322eb0=>setTimeout(_0x322eb0,_0x6498ad));}async[a104_0x519981(0x164)](){const _0x24615e=a104_0x519981,_0x1d91d2={};_0x1d91d2[_0x24615e(0x14e)]=_0x24615e(0x15b),_0x1d91d2[_0x24615e(0x178)]=_0x24615e(0x145);const _0x56a65d=_0x1d91d2;try{const _0x114234=await helper[_0x24615e(0x15e)](_0x56a65d[_0x24615e(0x14e)],_0x56a65d[_0x24615e(0x178)],null,null,this.#address);if(_0x114234)return!![];}catch(_0x4e9a96){return![];}}async['start'](){const _0x9ad6d4=a104_0x519981,_0x47363c={'tSUcK':_0x9ad6d4(0x151),'ekZck':'exec','UzOGX':function(_0x9ee90f,_0x399024,_0x2760a5,_0x450ba9){return _0x9ee90f(_0x399024,_0x2760a5,_0x450ba9);},'PCBvz':'close','IJdVL':_0x9ad6d4(0x172)},_0x34c8bd=await this.#getBinaryPath(),_0x2603e0={};_0x2603e0[_0x9ad6d4(0x174)]='a';const _0xbe46a0=fs[_0x9ad6d4(0x17f)](this.#logfile,_0x2603e0),_0x3af5bc=await this[_0x9ad6d4(0x152)](),_0x2ee8ad=await this['createPercyConfig']();if(!_0x3af5bc)return![];const _0x4ce8b1=[(this.#isApp?_0x47363c[_0x9ad6d4(0x17c)]:_0x47363c[_0x9ad6d4(0x144)])+_0x9ad6d4(0x179)];_0x2ee8ad&&_0x4ce8b1[_0x9ad6d4(0x16c)]('-c',_0x2ee8ad);this.#proc=_0x47363c['UzOGX'](spawn,_0x34c8bd,_0x4ce8b1,{'env':Object[_0x9ad6d4(0x169)](process['env'],{'PERCY_TOKEN':_0x3af5bc,'TH_BUILD_UUID':process[_0x9ad6d4(0x15a)][testHubConstants[_0x9ad6d4(0x17b)][_0x9ad6d4(0x14f)]]})}),this.#proc['stdout'][_0x9ad6d4(0x181)](_0xbe46a0),this.#proc['stderr'][_0x9ad6d4(0x181)](_0xbe46a0),this[_0x9ad6d4(0x17e)]=!![];var _0x345410=this;this.#proc['on'](_0x47363c[_0x9ad6d4(0x17d)],function(_0x4679b8){const _0x209501=_0x9ad6d4;_0x345410[_0x209501(0x17e)]=![];});do{const _0x4959eb=await this[_0x9ad6d4(0x164)]();if(_0x4959eb)return logger[_0x9ad6d4(0x150)](_0x47363c[_0x9ad6d4(0x142)]),!![];await this.#sleep(0x3e8);}while(this[_0x9ad6d4(0x17e)]);return![];}async['stop'](){const _0x501a93=a104_0x519981,_0x460bd5={'WIsZQ':function(_0x316d2f,_0x2e761f){return _0x316d2f(_0x2e761f);},'biUWf':function(_0x459674,_0xc2dc2a,_0x54d9f0){return _0x459674(_0xc2dc2a,_0x54d9f0);},'RPoPv':_0x501a93(0x183),'GNIyu':_0x501a93(0x16f)},_0x231bee=await this.#getBinaryPath();return new Promise((_0x1895f2,_0x3677b6)=>{const _0xd82310=_0x501a93,_0x57b2ac=_0x460bd5['biUWf'](spawn,_0x231bee,[_0x460bd5[_0xd82310(0x173)]]);_0x57b2ac['on'](_0x460bd5[_0xd82310(0x13b)],_0x23d149=>{const _0x377959=_0xd82310;this[_0x377959(0x17e)]=![],_0x460bd5[_0x377959(0x190)](_0x1895f2,_0x23d149);});});}[a104_0x519981(0x13f)](){const _0x1c5a30=a104_0x519981;return this[_0x1c5a30(0x17e)];}async[a104_0x519981(0x152)](){const _0x41755d=a104_0x519981,_0x4d79a9={};_0x4d79a9[_0x41755d(0x184)]='app',_0x4d79a9[_0x41755d(0x170)]=_0x41755d(0x182),_0x4d79a9[_0x41755d(0x148)]='GET',_0x4d79a9[_0x41755d(0x186)]=_0x41755d(0x13d);const _0x3d4ab3=_0x4d79a9,_0x3c568d=this.#config[_0x41755d(0x180)];try{const _0x5f2c55=this.#isApp?_0x3d4ab3[_0x41755d(0x184)]:_0x3d4ab3[_0x41755d(0x170)],_0x154d44=await helper[_0x41755d(0x15e)](_0x3d4ab3[_0x41755d(0x148)],'api/app_percy/get_project_token?name='+_0x3c568d+_0x41755d(0x18c)+_0x5f2c55,{},this.#config),_0x35782b=_0x154d44[_0x41755d(0x155)];return logger[_0x41755d(0x150)](_0x3d4ab3[_0x41755d(0x186)]),_0x35782b[_0x41755d(0x140)];}catch(_0x2f1e5f){return logger['error'](_0x41755d(0x149)+_0x2f1e5f),null;}}async[a104_0x519981(0x16d)](){const _0x1c6aa6=a104_0x519981,_0x247259={'PcudP':function(_0x4b15a0,_0x56d458){return _0x4b15a0(_0x56d458);},'FdLFo':function(_0x39307e,_0x3504ce){return _0x39307e+_0x3504ce;},'IqJpO':_0x1c6aa6(0x15c),'iVIwI':_0x1c6aa6(0x14d)};if(!this.#config['percyOptions'])return null;const _0xae6610=path['join'](os[_0x1c6aa6(0x154)](),_0x247259[_0x1c6aa6(0x18d)]),_0x43bcd8=this.#config[_0x1c6aa6(0x143)];return!_0x43bcd8[_0x1c6aa6(0x146)]&&(_0x43bcd8[_0x1c6aa6(0x146)]='2'),new Promise((_0x361d65,_0x4e33f7)=>{const _0x2b8cf9=_0x1c6aa6,_0x2f0730={'QXHEL':function(_0x346a99,_0x281a8e){const _0x2d0037=a104_0xb9c3;return _0x247259[_0x2d0037(0x13e)](_0x346a99,_0x281a8e);},'sWIaF':function(_0x1d9e5a,_0x42f6d3){const _0x212a14=a104_0xb9c3;return _0x247259[_0x212a14(0x16e)](_0x1d9e5a,_0x42f6d3);},'NNzxx':_0x247259[_0x2b8cf9(0x168)]};fs[_0x2b8cf9(0x185)](_0xae6610,JSON[_0x2b8cf9(0x141)](_0x43bcd8),_0x4a8fc8=>{const _0x4b8e8b=_0x2b8cf9;_0x4a8fc8&&(logger[_0x4b8e8b(0x14a)](_0x4b8e8b(0x13c)+_0x4a8fc8),_0x2f0730[_0x4b8e8b(0x175)](_0x361d65,null)),logger[_0x4b8e8b(0x150)](_0x2f0730[_0x4b8e8b(0x162)](_0x2f0730[_0x4b8e8b(0x15d)],_0xae6610)),_0x2f0730[_0x4b8e8b(0x175)](_0x361d65,_0xae6610);});});}}module[a104_0x519981(0x187)]=Percy;function a104_0x10ea(){const _0x4c8369=['healthcheck','percy.log','2099315RYsQtH','end','IqJpO','assign','22FiDzqK','PERCY_SERVER_ADDRESS','push','createPercyConfig','FdLFo','close','bKEGo','772KKDWQq','Percy\x20healthcheck\x20successful','RPoPv','flags','QXHEL','13736ksOfna','../../helpers/testhub/constants','InANW',':start','11OCmfOI','ENV_VAR','tSUcK','PCBvz','isProcessRunning','createWriteStream','projectName','pipe','automate','exec:stop','OIDtC','writeFile','APMcT','exports','6UcVqRZ','path','42399CydNKs','start','&type=','iVIwI','join','../helper','WIsZQ','GNIyu','Error\x20creating\x20percy\x20config:\x20','Percy\x20fetch\x20token\x20success','PcudP','isRunning','token','stringify','IJdVL','percyOptions','ekZck','percy/healthcheck','version','15335398alNuIr','ZbBAW','Percy\x20unable\x20to\x20fetch\x20project\x20token:\x20','error','10ncldyb','../../helpers/performance/performance-tester','percy.json','GgyLO','BROWSERSTACK_TESTHUB_UUID','debug','app:exec','fetchPercyToken','2370ETYkCN','tmpdir','data','winstonLogger','7363716JulWRK','DOWNLOAD','976941LTyyjl','env','GET','Percy\x20config\x20created\x20at\x20','NNzxx','nodeRequest','../logger','../../helpers/performance/constants','280sGUBQB','sWIaF','app'];a104_0x10ea=function(){return _0x4c8369;};return a104_0x10ea();}